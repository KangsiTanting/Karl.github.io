---
layout: post
title: Servlet
description: Servlet
category: Servlet+Jsp
photos:
link: http://www.google.com/
tags:
---
# Servlet

# 1 javaweb的13种技术规范

> javaweb开发种定义好的13种模板代码来解决对应的常见的问题

~~~
        1、JDBC（java Database Connectivity）：连接数据库
        2、JNDI(Java Name and Directory Interface):命名服务
        3、EJB（Enterprise JavaBean）：javabean


        4、RMI（RemoteMethod Invoke）：远程方法调用
 
 
        5、Java IDL：接口定义语言
 
 
        6、JSP(Java Server Pages):服务器端页面
 
 
        7、Java Servlet：接受请求处理数据的java类
 
 
        8、XML（Extensible Markup Language）：xml配置文件
 
        9、JMS（Java Message Service）：消息中间件
 
 
        10、JTA（Java Transaction Architecture）：事务监控。
 
 
        11、JTS（Java  Transaction Service）:事务服务
 
 
        12、JavaMail：y
        13、JAF（JavaBeans Activation Framework）：邮件附件
~~~

# 2 servlet概念

> javaweb的13种技术规范之一
>
> 一个特殊(格式固定)的用于接受请求 处理数据 给予响应的java 类
>
> –是在服务器端运行，用于处理用户的请求并给予响应的Java程序

# 3 创建servlet的方式

## 3.1 实现javax.servlet.Servlet接口

> 1 创建servlet

~~~ java
package com.zhiyou100.web02servlet;
public class Demo01   implements Servlet {

	//销毁方法：servlet销毁前要调用的方法
	public void destroy() {
		System.out.println("public void destroy():销毁方法");
		
	}

	//获取servlet配置文件信息对象的方法
	public ServletConfig getServletConfig() {
		return null;
	}

	//获取servlet作者版本的信息
	public String getServletInfo() {
		return null;
	}

	//初始化方法：servlet对象一创建就要调用的方法
	public void init(ServletConfig arg0) throws ServletException {
		System.out.println("public void init(ServletConfig arg0):初始化方法");
		
	}

	//服务方法：接受请求 处理数据  给予响应
	public void service(ServletRequest arg0, ServletResponse arg1) throws ServletException, IOException {
		System.out.println("public void service(ServletRequest arg0, ServletResponse arg1)：服务方法");
		
	}
}
~~~

> 2 在核心配置web.xml文件中配置servlet

~~~ xml
 <servlet>
       <servlet-name>day01_demo01</servlet-name>
        <!-- 与servet-mapping标签关联 -->
       <servlet-class>com.zhiyou100.web02servlet.Demo01</servlet-class>
        <!-- 指定类的全路径 -->
  </servlet>
  <servlet-mapping>
        <servlet-name>day01_demo01</servlet-name>
        <!-- 与servet标签关联 -->
        <url-pattern>/day01/s1</url-pattern>
         <!-- 虚拟路径：客户端请求此servlet时用的路径   必须以/开头-->
  </servlet-mapping>
~~~

> 3 发布项目 访问servlet  ：http://localhost:8080/java34_web/day01/s1

## 3.2 继承抽象类GenericServlet类

> GenericServlet抽象类是Servlet接口的实现类：帮助我们实现了除了service外的其他方法

> 1 继承GenericServlet

~~~ java
package com.zhiyou100.web02servlet;
public class Demo02  extends GenericServlet{
    //其他方法可以根据需求重写
	//但必须重写service方法
	public void service(ServletRequest arg0, ServletResponse arg1) throws ServletException, IOException {
		  System.out.println("public void service:服务");
	}
}
~~~

> 2 在web.xml中配置此servlet

~~~ xml
<!-- 配置servlet: Demo02.java-->
<servlet>
    <servlet-name>day01_demo02</servlet-name><!-- 与servet-mapping标签关联 -->
    <servlet-class>com.zhiyou100.web02servlet.Demo02</servlet-class><!-- 指定类的全路径 -->
</servlet>
<servlet-mapping>
    <servlet-name>day01_demo02</servlet-name><!-- 与servet标签关联 -->
    <url-pattern>/day01/s2</url-pattern><!-- 虚拟路径：客户端请求此servlet时用的路径   必须以/开头-->
</servlet-mapping>
~~~

> 3 浏览器访问

## 3.3 继承HttpServlet类：专门针对于http协议的请求

> 1 继承HttpServlet类 重写doGet和doPost方法  否则响应错误码405

~~~ java
package com.zhiyou100.web02servlet;

public class Demo03 extends HttpServlet {
	@Override
	protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		System.out.println("接受get请求");
		resp.setContentType("text/html;charset=utf-8");
		resp.setCharacterEncoding("UTF-8");
		resp.getWriter().print("<font color='red' size='7'>额呵呵 响应成功!</font>");
	}
	@Override
	protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		System.out.println("接受post请求");
	}      
}
~~~

> 2 配置：略

> 3 请求：略

# 4 servlet的生命周期

* Servlet的对象由Tomcat创建： web容器(创建和维护servlet对象)
* 一个Servlet  Tomcat只创建一个对象
* Tomcat接受到客户端请求时  会调用对应的servlet对象的service方法来接受请求

### 4.1 创建对象

* 默认情况下 servlet第一次被请求时 Tomcat创建此servelt的单例对象
* 如果在servlet的配置文件中配置<load-on-startup>标签 Tomcat在启动时 就创建此servlet的单例对象

### 4.2 初始化

* servlet对象一创建  Tomcat就立刻调用对象的init方法对servlet对象进行初始化

### 4.3 服务

* servlet每被调用一次  Tomcat就执行一次servlet的service方法 来接受请求处理数据 给予响应

### 4.4 销毁

* Tomcat关闭之前  调用Servlet的destroy方法 来释放资源 销毁对象

# 5 在项目中加入servlet的jar

> javax包不是jre中的包  项目需要引入servlet-api.jar这个包
>
> tomcat中就有此包----可以选择把整个tomcat中依赖的包引入项目中

![image-20210320114544636](https://i.loli.net/2021/03/20/vmt1zD8TGF37iSU.png)

![image-20210320114634466](C:/Users/AppData/Roaming/Typora/typora-user-images/image-20210320114634466.png)

![image-20210320114706853](https://i.loli.net/2021/03/20/cOEBZ1f7eqdCSUi.png)

# 6 使用servlet实现登录

## 6.1 创建数据

~~~sql
DROP TABLE student;
CREATE TABLE student(
    sid INT PRIMARY KEY AUTO_INCREMENT,
    sname VARCHAR(11),
    spwd VARCHAR(11),
    score FLOAT(4,1)
);
INSERT INTO student(sname,spwd,score) VALUES("韩梅梅","123",11.5);
INSERT INTO student(sname,spwd,score) VALUES("韩寒","123",21.5);
INSERT INTO student(sname,spwd,score) VALUES("韩庚","123",31.5);
INSERT INTO student(sname,spwd,score) VALUES("韩非子","123",41.5);
~~~

## 6.2 创建项目--分包

![image-20210320115400543](C:/Users/AppData/Roaming/Typora/typora-user-images/image-20210320115400543.png)

## 6.3 导入依赖的jar包

![image-20210320115819775](C:/Users/AppData/Roaming/Typora/typora-user-images/image-20210320115819775.png)

## 6.4 创建实体类：和表对应

~~~ java
public class Student implements Serializable {
	private Integer sid;
	private String sname;
	private String spwd;
	private Float score;
    ...
}
~~~

## 6.5 创建工具类：连接数据库 字符串操作  日期转换

![image-20210320120313809](https://i.loli.net/2021/03/20/lO32cKInZS5ftpP.png)

## 6.6 创建页面

~~~ html
 <form method="get" action="">
          <table>
              <tr>
                  <th>學生名字:</th>
                  <td><input type="text" name="sname"/></td>
              </tr>
              <tr>
                  <th>學生密碼:</th>
                  <td><input type="text" name="sname"/></td>
              </tr>
              <tr>
                  <th colspan="2">
                      <input  type="reset" value="重置"/>
                      &nbsp; &nbsp; &nbsp; &nbsp;
                      <input  type="submit" value="登陸"/>
                  </th>
              </tr>
          </table>
</form>
~~~

## 6.7 创建servlet

~~~ java
package com.zhiyou100.web03servlet.servlet;
public class UserLoginServlet   extends HttpServlet{
	@Override
	protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		req.setCharacterEncoding("utf-8");//设置请求参数的编码集
		//接受請求 處理数据 给予响应
		//接受页面的sname和spwd
		String sname=req.getParameter("sname");//名字必须和表单组件的name属性一致
		String spwd=req.getParameter("spwd");
		//连接数据库 判断用户和密码是否有对应的student对象
		System.out.println(sname+":::"+spwd);
		Connection con=JdbcUtil.getCon();
		PreparedStatement pre=null;
		ResultSet set=null;
		Student stu=null;
		try {
			pre=con.prepareStatement("select * from student where sname=? and spwd=?");
			pre.setString(1, sname);
			pre.setString(2, spwd);
			set=pre.executeQuery();
			if(set.next()) {
				int sid=set.getInt("sid");
				float score=set.getFloat("score");
				stu=new Student(sid, sname, spwd, score);
			}
		} catch (Exception e) {
			throw new RuntimeException(e);
		}finally{
			JdbcUtil.close(con, pre, set);
		}
		System.out.println(stu);
		//设置响应编码集
		resp.setContentType("text/html;charset=utf-8");
		resp.setCharacterEncoding("utf-8");
		//判断登陆成功还是失败
		if(stu==null) {
			resp.getWriter().print("<font size='7' color='red'>登陆失败！</font>");
		}else {
			resp.getWriter().print("<font size='7' color='blue'>登陆成功!</font>");
		}
	}
	protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		doGet(req, resp);//dopost方法要指定的代码和doget完全相同
	}
}
~~~

## 6.8 在web.xml中配置servlet

~~~ xml
<!-- 配置servlet: UserLoginServlet.java-->
<servlet>
    <servlet-name>day01_demo04</servlet-name><!-- 与servet-mapping标签关联 -->
    <servlet-class>com.zhiyou100.web03servlet.servlet.UserLoginServlet</servlet-class><!-- 指定类的全路径 -->
</servlet>
<servlet-mapping>
    <servlet-name>day01_demo04</servlet-name><!-- 与servet标签关联 -->
    <url-pattern>/day01/s4login</url-pattern><!-- 虚拟路径：客户端请求此servlet时用的路径   必须以/开头-->
</servlet-mapping>
~~~

## 6.9 修改页面的action 为此servlet的url

~~~ html
<form method="get" action="/java34_web/day01/s4login">
~~~

## 6.10 发布项目  访问html







# 7. servlet中几个重要对象的介绍

~~~ java
/ *
 *	servlet:中常用的几个对象‘
 * 1 HttpServletRequest request:  请求对象：与请求相关的所有数据和功能
 * 2 HttpServletResponse response:响应对象：与响应相关的所有数据和功能
 *    tomcat在每接受到客户端对Aservlet的请求时 tomcat会创建两个对象：
      request对象+response对象
 *    request对象用于装和请求相关的所有内容
 *    response对象用于装和响应相关的所有内容
 *    然后调用此servlet的service方法时 传递这两个对象
 *    service方法就可以通过request对象来处理数据 通过reponse对象来给予响应
 * 3  ServletConfig：conf:配置对象 ： 当前servelt的配置信息
 * 4  HttpSession： session:会话对象  ：  实现整个回话之间的数据共享
 * 5  ServletContext context:上下文对象 ：实现整个项目之间的数据共享
 */
~~~

## 7.1 HttpServletRequest请求对象

> **tomcat接收到每次请求时 都会创建一个request对象来装与本次请求相关的所有信息**

### 7.1.1与请求参数(Parameter)相关的方法

* String getParameter(name)；获取单值请求参数
* String[] getParameterValues(name)；获取多值请求参数
* Enumeration<String> getParameterNames()；获取所有的请求参数名
* Map<String, String[]>  getParameterMap()；获取所有请求参数对应的map
* void setCharacterEncoding(encodingName)；设置请求参数编码集
* String getCharacterEncoding()；获取请求参数编码集

~~~ java
//1 与请求参数相关的方法:parameter:参数名=参数值
String name=req.getParameter("sname");//获取单值请求参数
System.out.println("单值参数:name="+name);
String[] enjoys=req.getParameterValues("senjoy");//获取多值请求参数
System.out.println("多值参数:senjoy="+Arrays.toString(enjoys));
Enumeration<String> names=req.getParameterNames();//获取所有的请求参数名字
while(names.hasMoreElements()) {
    System.out.println("参数名="+names.nextElement());
}
Map<String, String[]> map=req.getParameterMap();
Set<Entry<String, String[]>> entrys=map.entrySet();
for (Entry<String, String[]> entry : entrys) {
    System.out.println("请求参数：：：："+entry.getKey()+"="+Arrays.toString(entry.getValue()));
}
req.setCharacterEncoding("UTF-8");//设置请求参数编码集
String encoding=req.getCharacterEncoding();//获取请求参数编码集

~~~

### 7.1.2 与请求头相关的方法

* Enumeration<String>  getHeaderNames()；获取所有的请求头名
* String getHeader(headerName)；由请求头名获取请求头值

~~~ java
//2 与请求头相关的方法: header
Enumeration<String> headerNames=req.getHeaderNames();//获取所有的请求头名
while(headerNames.hasMoreElements()) {
    String headerName=headerNames.nextElement();
    String headerValue=req.getHeader(headerName);//由请求头名获取请求头值
    System.out.println("请求头：：："+headerName+":"+headerValue);
}
~~~

### 7.1.3 与请求相关的其他方法

~~~ java
//3 与请求相关的其他方法
System.out.println("获取请求方式getMethod："+req.getMethod());
System.out.println("获取项目路径getContextPath:"+req.getContextPath());
System.out.println("获取服务器地址getLocalAddr:"+req.getLocalAddr());
System.out.println("获取服务器端口getLocalPort:"+req.getLocalPort());
System.out.println("获取请求参数getQueryString:"+req.getQueryString());
System.out.println("获取真实路径req.getRealPath("/"):"+req.getRealPath("/"));
System.out.println("获取客户端地址getRemoteAddr:"+req.getRemoteAddr());
System.out.println("获取客户端端口getRemotePort:"+req.getRemotePort());
System.out.println("获取session对象getSession:"+req.getSession());
System.out.println("获取上下文对象getServletContext:"+req.getServletContext());
System.out.println("获取servlet的虚拟路径getServletPath:"+req.getServletPath());
System.out.println("获取请求的字节输入流getInputStream:"+req.getInputStream());
~~~

### 7.1.4作为域对象

> **request域对象：实现同一个request链的多个servlet之间数据的共享**
>
> **域对象：在指定区域之间实现数据共享**
> **域对象中存放的共享数据叫域属性：Attribute**

* void setAttribute(name, Object)；设置域属性
* void req.removeAttribute(name)；删除域属性
* Object getAttribute(name)；获取域属性
* Enumeration<String> getAttributeNames()；获取所有的域属性名

~~~ java
req.setAttribute("aa", "aa_1");//设置域属性
req.setAttribute("bb", new Student());
req.setAttribute("cc", new Date());
req.removeAttribute("aa");//删除指定的域属性
System.out.println("域属性：aa="+req.getAttribute("aa"));
Enumeration<String> attrNames=req.getAttributeNames();//获取所有的域属性名字
while(attrNames.hasMoreElements()) {
    String attrName=attrNames.nextElement();
    System.out.println("域属性："+attrName+"="+req.getAttribute(attrName));
}
~~~

### 7.1.5 请求转发和请求包含

~~~ java
//5 请求转发+请求包含 :一个请求被多个servlet处理
RequestDispatcher dispatcher=req.getRequestDispatcher("/day04/s11");
//dispatcher.forward(req, response);//请求转发
dispatcher.include(req, response);//请求包含
~~~

# 面试题：get请求和post请求的区别

* 3.1 请求方式不同

  ~~~
  get请求：地址栏输入、超链接、form表单的method=get
  post请求：form表单的method=post
  ~~~

* 3.2 数据安全性不同

~~~
get请求：地址栏显示请求资源的地址和请求参数
post请求:地址栏只显示请求资源的地址  不显示请求参数  数据安全性好
~~~

* 3.3 可传递的数据长度不同

~~~
get请求：服务器接收到的请求参数在请求协议的请求首行中  请求首行长度不能大于1kb 不能传递大数据
post请求：服务器接受到的请求参数在请求协议的请求体中  http对请求体没有大小限制 可以传递大数据
~~~

* 3.4 处理乱码方式不同

~~~
tomcat8之前 request.setCharacterEncoding()方法只能设置请求体的编码集：此方法只能影响post请求参数，get请求需要先编码后 二次解码才能得到正确的参数值
tomcat9之后 在tomcat的server.xml中设置useBodyEncodingForURI="true"此方法两者都能有效
~~~

## 7.2HttpServletResponse响应对象

****

> **tomcat接收到每次请求时 都会创建一个response对象来装与本次响应相关的所有信息**

### 7.2.1 与响应头相关的方法

* void setHeader("aa", "aa_value")；设置响应头
* String getHeader("aa")；获取响应头
* Collection<String> getHeaderNames()；获取所有响应头名
* void addCookie(Cookie)；添加cookie

~~~ java
resp.setHeader("aa", "aa_value");//设置响应头
System.out.println("/day04/s3 aa="+resp.getHeader("aa"));//获取响应头
Collection<String> names=resp.getHeaderNames();//获取所有需要头名
for (String name : names) {
    System.out.println("/day04/s3 响应头：：："+name+"="+resp.getHeader(name));
}
//resp.addCookie(Cookie);//添加cookie
~~~

### 7.2.2与响应体相关的方法

* void setCharacterEncoding("gbk")；设置响应体字符流的编码集
* void setContentType("text/html;charset=gbk")；设置响应内容的格式
* Writer getWriter()；获取字符输出流
* OutputStreamgetOutputStream()；获取字节输出流

**注意获取字节输出流和获取字符输出流不能同时使用**

~~~ java
resp.setCharacterEncoding("gbk");//设置响应体字符流的编码集
resp.setContentType("text/html;charset=gbk");//设置响应内容的格式
Writer out=resp.getWriter();//获取字符输出流
out.write("<font  color='red' size='7'>你好客户端</font>");
out.flush();
OutputStream out=resp.getOutputStream();//获取字节输出流
File file=new File(req.getContextPath()+"/imgs/1.jpg");
System.out.println(file.getAbsolutePath());
file=new File(req.getRealPath("/imgs/1.jpg"));
FileInputStream fin=new FileInputStream(file);
byte[] arr=new byte[1024];
int b; 
while((b=fin.read(arr))!=-1) {
    out.write(arr, 0, b);
}
fin.close();
~~~

### 7.2.3 重定向

* void sendRedirect("/java34_web/day04/s2")；重定向到指定的资源

~~~ java
resp.sendRedirect("/java34_web/day04/s2");
~~~

### 7.2.4 其他方法

* void sendError(404, "请求的资源不存在！")；设置响应的错误信息
* void resp.setStatus(302)；设置响应状态码

~~~ java
//resp.sendError(404, "请求的资源不存在！");//设置响应错误信息
resp.setStatus(302);//设置响应状态码
//resp.setHeader("location.href", "/java34_web/day04/s2");
resp.setHeader("Refresh", "1;URL=http://localhost:8080/java34_web/day04/s2");//设置响应头
resp.setHeader("Refresh", "1;/java34_web/day04/s2");
~~~

# 5实现增删改查

## 5.1 创建数据

~~~sql
DROP TABLE student;
CREATE TABLE student(
    sid INT PRIMARY KEY AUTO_INCREMENT,
    sname VARCHAR(11),
    spwd VARCHAR(11),
    score FLOAT(4,1)
);
INSERT INTO student(sname,spwd,score) VALUES("韩梅梅","123",11.5);
INSERT INTO student(sname,spwd,score) VALUES("韩寒","123",21.5);
INSERT INTO student(sname,spwd,score) VALUES("韩庚","123",31.5);
INSERT INTO student(sname,spwd,score) VALUES("韩非子","123",41.5);
~~~

## 5.2 创建项目--分包

![image-20210320115400543](C:/Users/GuiyingLiang/Desktop/AppData/Roaming/Typora/typora-user-images/image-20210320115400543.png)

## 5.3 导入依赖的jar包

![image-20210320115819775](C:/Users/GuiyingLiang/Desktop/AppData/Roaming/Typora/typora-user-images/image-20210320115819775.png)

## 5.4 创建实体类：和表对应

~~~ java
public class Student implements Serializable {
	private Integer sid;
	private String sname;
	private String spwd;
	private Float score;
    ...
}
~~~

## 5.5 创建工具类：连接数据库 字符串操作  日期转换

![image-20210320120313809](https://i.loli.net/2021/03/20/lO32cKInZS5ftpP.png)

## 5.6 创建servlet：

### 获取所有

~~~ java
public ArrayList<Student> getAll() {
		Connection con=JdbcUtil.getCon();
		PreparedStatement pre=null;
		ResultSet result=null;
		ArrayList<Student> list=new ArrayList<Student>();
		try {
			pre=con.prepareStatement("select * from student ");
			result=pre.executeQuery();
			while(result.next()) {
				Student s=new Student(result.getInt("sid"), result.getString("sname"), result.getFloat("score"),
						result.getTimestamp("stime"), result.getInt("tid"));
				list.add(s);
			}
		} catch (Exception e) {
			throw new RuntimeException(e);
		}
		return list;
	}
~~~



### 根据sid获取

~~~ java
public Student getOntBySid(int sid) {
		Connection con=JdbcUtil.getCon();
		PreparedStatement pre=null;
		ResultSet result=null;
		Student s=null;
		try {
			pre=con.prepareStatement("select * from student where sid=?");
			pre.setInt(1, sid);
			result=pre.executeQuery();
			if(result.next()) {
				s=new Student(sid, result.getString("sname"), result.getFloat("score"),
						result.getTimestamp("stime"), result.getInt("tid"));
			}
		} catch (Exception e) {
			throw new RuntimeException(e);
		}
		return s;
	}
~~~



### 添加一个

~~~ java
public int insertOne(Student s) {
		Connection con=JdbcUtil.getCon();
		PreparedStatement pre=null;
		int hang=0;
		try {
			pre=con.prepareStatement("insert into student(sname,score,stime,tid) values(?,?,?,?)");
			pre.setString(1, s.getSname());
			pre.setFloat(2, s.getScore());
			pre.setTimestamp(3, new Timestamp(s.getStime().getTime()));;
			pre.setInt(4, s.getTid());
			hang=pre.executeUpdate();
		} catch (Exception e) {
			throw new RuntimeException(e);
		}
		return hang;
	}
~~~



### 根据sid删除一个

~~~ java
public int deleteOne(int sid) {
		Connection con=JdbcUtil.getCon();
		PreparedStatement pre=null;
		int hang=0;
		try {
			pre=con.prepareStatement("delete from student where sid=?");
			pre.setInt(1, sid);
			hang=pre.executeUpdate();
		} catch (Exception e) {
			throw new RuntimeException(e);
		}
		return hang;
	}
~~~



### 修改一个

~~~ java
public int updateOne(Student s) {
		Connection con=JdbcUtil.getCon();
		PreparedStatement pre=null;
		int hang=0;
		try {
			pre=con.prepareStatement("update student set sname=?,score=?,stime=?,tid=? where sid=?");
			pre.setString(1, s.getSname());
			pre.setFloat(2, s.getScore());
			pre.setTimestamp(3, new Timestamp(s.getStime().getTime()));;
			pre.setInt(4, s.getTid());
			pre.setInt(5, s.getSid());
			hang=pre.executeUpdate();
		} catch (Exception e) {
			throw new RuntimeException(e);
		}
		return hang;
	}
~~~





# 面试题：请求转发 请求包含 重定向的区别

> 都是可以实现资源跳转的方式

* 目的资源：/day05/sr

~~~ java
@WebServlet("/day05/sr")
public class Demo01ResultServlet extends HttpServlet {

    public void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        req.setCharacterEncoding("UTF-8");
        String name=req.getParameter("name");//获取请求参数
        System.out.println("sr；请求参数-----name="+name);
        Object aaValue=req.getAttribute("aa");//获取域属性
        System.out.println("sr；request域属性-----aa="+aaValue);
        //设置响应头
        resp.setHeader("rr", "rr_value");
        resp.setCharacterEncoding("UTF-8");
        resp.setContentType("text/html;charset=utf-8");
        PrintWriter out=resp.getWriter();
        out.print("<font  color='red' size='7'>Demo01ResultServlet设置响应体成功！！！</font><br/>");
        out.print("<font  color='red' size='7'>请求参数name="+name+"</font><br/>");
        out.print("<font  color='red' size='7'>域属性aa="+aaValue+"</font><br/>");
    }

    public void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        doGet(req, resp);
    }
}
~~~

## 1.1 请求转发

* AServlet请求转发到sr

~~~ java
package com.zhiyou100.web05servlet;
@WebServlet("/day05/sa")
public class Demo01AServlet extends HttpServlet {
	public void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		req.setCharacterEncoding("UTF-8");
		//请求转发到sr
		String name=req.getParameter("name");//获取请求参数
		System.out.println("sa获取请求参数-----name="+name);
		req.setAttribute("aa", "sa_forward");//设置request域属性
		resp.setHeader("header_a", "header_a_value");//设置响应头
		//设置响应体
		resp.setCharacterEncoding("UTF-8");
		resp.setContentType("text/html;charset=utf-8");
		PrintWriter out=resp.getWriter();
	    out.print("<font  color='red' size='7'>Demo01AServlet设置响应体成功！！！</font><br/>");
        //请求转发到sr
	    req.getRequestDispatcher("/day05/sr").forward(req, resp);
	}
	public void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		doGet(request, response);
	}
}
~~~

* 结果分析

~~~
sa请求转发到sr
地址栏：
    http://localhost:8080/java34_web/day05/sa?name=tom
响应体：
    Demo01ResultServlet设置响应体成功！！！
	请求参数name=tom
	域属性aa=sa_forward
响应头：
    header_a：header_a_value
    rr：rr_value	
状态码：200
打印内容：
    sa获取请求参数-----name=tom
	sr；请求参数-----name=tom
	sr；request域属性-----aa=sa_forward
~~~

![image-20210323154911866](https://i.loli.net/2021/03/23/DcIFGv3flQd4MgH.png)

## 1.2 请求包含

* sb请求包含到sr

~~~ java
package com.zhiyou100.web05servlet;
@WebServlet("/day05/sb")
public class Demo01BServlet extends HttpServlet {
	public void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		req.setCharacterEncoding("UTF-8");
		//请求包含到sr
		String name=req.getParameter("name");//获取请求参数
		System.out.println("sb获取请求参数-----name="+name);
		req.setAttribute("aa", "sb_include");//设置request域属性
		resp.setHeader("header_b", "header_b_value");//设置响应头
		//设置响应体
		resp.setCharacterEncoding("UTF-8");
		resp.setContentType("text/html;charset=utf-8");
		PrintWriter out=resp.getWriter();
	    out.print("<font  color='red' size='7'>Demo01BServlet设置响应体成功！！！</font><br/>");
        //请求包含到sr
	    req.getRequestDispatcher("/day05/sr").include(req, resp);
	}

	public void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		doGet(request, response);
	}
}
~~~

* 结果

~~~
sb请求包含到sr
地址栏：
      http://localhost:8080/java34_web/day05/sb?name=tom
响应体：
     Demo01BServlet设置响应体成功！！！
     Demo01ResultServlet设置响应体成功！！！
     请求参数name=tom
     域属性aa=sb_include
响应头： 
     header_b：header_b_value
状态码： 200
打印内容：
		sb获取请求参数-----name=tom
		sr；请求参数-----name=tom
		sr；request域属性-----aa=sb_include
~~~

![image-20210323154948526](https://i.loli.net/2021/03/23/6kb4Ws3nipczrtX.png)

## 1.3 重定向

* sc重定向到sr

~~~ java
@WebServlet("/day05/sc")
public class Demo01CServlet extends HttpServlet {

	public void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		req.setCharacterEncoding("UTF-8");
		//重定向到sr
		String name=req.getParameter("name");//获取请求参数
		System.out.println("sc获取请求参数-----name="+name);
		req.setAttribute("aa", "sc_redirect");//设置request域属性
		resp.setHeader("header_c", "header_c_value");//设置响应头
		//设置响应体
		resp.setCharacterEncoding("UTF-8");
		resp.setContentType("text/html;charset=utf-8");
		PrintWriter out=resp.getWriter();
	    out.print("<font  color='red' size='7'>Demo01CServlet设置响应体成功！！！</font><br/>");
        //重定向到sr
	    resp.sendRedirect(req.getContextPath()+"/day05/sr?name="+name);
	}

	public void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		doGet(request, response);
	}
}
~~~

* 结果

~~~
sc重定向到sr
地址栏：
     http://localhost:8080/java34_web/day05/sr
响应体：
    Demo01ResultServlet设置响应体成功！！！
	请求参数name=null
	域属性aa=null
响应头：
     rr=rr_value 
状态码：302---200
打印内容：
    sc获取请求参数-----name=tom
    sr；请求参数-----name=null
    sr；request域属性-----aa=null
~~~

![image-20210323155051651](https://i.loli.net/2021/03/23/FXN5w9dnGyBqzlx.png)

* 总结

~~~
请求转发和请求包含：a请求转发到b  a请求包含到b
相同之处：1 都是RequestDispatcher 请求调度器对象的方法
        2 都是一个请求被两个资源(servlet)处理  都可以使用request域对象来传递数据
        3 地址栏显示的都是a的路径
不同之处：1 a请求转发到b   只有b能设置响应体
          a请求包含到b  a和b都能设置响应体
        2 a请求转发到b   a和b都能设置响应头
          a请求包含到b  只有a能设置响应头
请求转发和重定向：a请求转发到b a重定向到b
不同之处：
       1 方法不同：请求转发是RequestDispatcher请求调度器对象的forward方法
                 请求包含是response的sendRedirect方法
       2 请求个数不同： 请求转发是一次请求 可以使用request域对象来传递数据
                      重定向是两次请求  不能使用request域对象来传递数据
       3 地址栏不同：a请求转发到b 地址栏显示的是a的路径
                   a重定向到b 地址栏显示的是b的路径
       4 路径写法不同： a请求转发到b ：是服务器端路径 /bpath            
                      a重定向到b：是客户端路径   /projectpath/bpath
       5 接受请求的方法不同：a请求转发到b  a和b处理请求的doget/dopost取决于请求的方式
                        a重定向到b a处理请求的doGet/doPost取决于请求的方式
                                 b一定是doGet(因为到达b是通过设置地址栏--是get请求)
~~~

# 2 路径的写法

~~~
客户端路径：在客户端发出的请求 ：所有的src/href/action/重定向
    写法1：绝对路径：     http://localhost:8080/java34_web/day05/path   
    写法2： 相对于当前主机：        /java34_web/day05/path
    写法3：  相对当前资源：        ../day05/path 
服务器端路径：    服务器端发出的请求：forward/include
    写法1：相当于当前资源：             path  
    写法2： 相对于当前项目：        /day05/path    
    req.getRequestDispatcher("/day05/path").forward(req, resp);//相当于当前项目
    req.getRequestDispatcher("path").forward(req, resp);//相当于当前资源： 
                            当前资源路径为/day05/s2  请求资源的路径为/day05/path        
url-pattern必须/xxx :相当于当前项目      
~~~

# 3 会话跟踪技术

* http：是一种互联网上基于请求/响应模式的无状态数据传输协议

* 无状态：两次请求之间不能数据共享

* 回话跟踪技术 解决http的无状态   ：：实现不同请求之间数据共享
* 回话跟踪技术：通过session   通过cookie

## 3.1 cookie

* **符合http规范的 由服务器端创建，客户端保存的 通过请求头和响应头来传输的 一种键值格式的数据**

* **奴隶身上的小纸条**

  cookie相关的方法

  ### 添加cookie:方式1：通过response的addCookie(cookie)

~~~
Cookie c1=new Cookie("c1"+System.currentTimeMillis(), "c1_value"+System.currentTimeMillis());//创建一个cookie对象
c1.setMaxAge(100);//cookie讲持久化保持到硬盘中100s
c1.setMaxAge(-1); //cookie保持在浏览器内存中
c1.setMaxAge(0);  //cookie有效时间是本次响应
resp.addCookie(c1);//把cookie添加都响应头中
~~~

### //添加cookie:方式2：通过设置响应头Set-Cookie

~~~ java
//resp.setHeader("Set-Cookie", "cc=cc_value");

//获取请求头中所有的cookie
Cookie[]  arr=req.getCookies();//获取请求头中所有的cookie
for (Cookie c : arr) {
     System.out.println("cookie:::"+c.getName()+"="+c.getValue());
}
~~~



![image-20210323162216394](https://i.loli.net/2021/03/23/LyhfTuAbQOGX3kI.png)

## 3.2 Seesion

* session：会话：同一个浏览器对服务器进行的几个连贯的请求
* ​    默认请求情况下：两次请求之间时间间隔不超过30分钟
* **地主家的账本**

> **当客户端请求服务器端时， 服务器端判断请求头中是否有名为JSESSIONID的cookie ，如果没有就说明这次请求是本次回话的第一次请求，服务器就在服务器端为本次回话创建一个Session对象 用于保存本次回话的共享数据，以JSESSIONID为名，session对象的地址作为值创建一个cookie添加到响应头中  从此以后此客户端每次请求服务器端时 都会带上这个cookie **

> **jsessionid的cookie只保留在浏览器内存中   并且时间间隔不能超过30分钟**

* 由服务器端创建  由服务器端保存

* 依赖于名为JSESSIONID的cookie

* 每个会话对应一个session对象

  **session相关的方法**

  ### //获取session

~~~
HttpSession session=req.getSession();
~~~

### //获取所有的域属性名

~~~ java
String str="";
Enumeration<String> names=session.getAttributeNames();//获取所有域属性名
session.setAttribute("aa", "aa_1");//添加域属性
session.removeAttribute("aa");//删除域属性
while(names.hasMoreElements()) {
    String name=names.nextElement();
    System.out.println("域属性："+name+":"+session.getAttribute(name));
}
~~~

### //其他方法

~~~ java
//session.invalidate();//销毁session
//session.getId()//获取对应的jsession的cookie的值
//ServletContext session.getServletContext();获取上下文对象
~~~



![image-20210323163833337](https://i.loli.net/2021/03/23/mgt7S3lThIvCLay.png)



# 4 ServletContext:上下文对象

~~~ java
//获取servletcontext:上下文对象
ServletContext context=null;
context=req.getServletContext();
context=req.getSession().getServletContext();
context=this.getServletConfig().getServletContext();
context=this.getServletContext();
//作为域对象：实现整个项目之间的数据的共享：
context.setAttribute("name", "智游臻龙科技股份有限公司");
System.out.println("获取session的过期时间="+context.getSessionTimeout());
System.out.println("获取资源的mime类型="+context.getMimeType("1.png"));
System.out.println("获取项目的真实路径="+context.getRealPath("/"));
System.out.println("获取项目路径="+context.getContextPath());
~~~

# 5 servlet的练习

~~~
创建两个表：Teacher:tid tname tpwd 
          Student:sid sname score stime tid
          注意：stime是本分数插入或者最后一次修改的时间
               tid是本分数插入或者最后一次修改的老师的编号
1：老师的登陆和退出
2：老师对所有学生的正删改查
   (页面显示当前老师的信息：登陆时把登陆者的信息存入session )
   (每个页面显示当前登陆的老师人数：在servletcontext中设置一个域属性来记录登陆者的个数)
~~~

## 1 创建数据库

~~~sql
USE db_3;
DROP TABLE teacher;
CREATE TABLE teacher(
    tid INT PRIMARY KEY AUTO_INCREMENT,
    tname VARCHAR(11),
    tpwd VARCHAR(11)
);
INSERT INTO teacher VALUES(NULL,"韩梅梅","123");
INSERT INTO teacher VALUES(NULL,"韩庚","123");
INSERT INTO teacher VALUES(NULL,"韩非子","123");
INSERT INTO teacher VALUES(NULL,"韩信","123");
DROP TABLE student;
CREATE TABLE student(
    sid INT PRIMARY KEY AUTO_INCREMENT,
    sname VARCHAR(11),
    score FLOAT(4,1),
    stime DATETIME COMMENT '添加或者最后的修改时间',
    tid INT COMMENT '添加或者最后的修改的老师编号',
    CONSTRAINT kf_1 FOREIGN KEY(tid) REFERENCES teacher(tid)
);
INSERT INTO student VALUES(NULL,"孙悟空",34.5,'2020-1-1',1);
INSERT INTO student VALUES(NULL,"唐僧",44.5,'2021-1-1',2);
INSERT INTO student VALUES(NULL,"猪八戒",54.5,'2021-1-1',1);
INSERT INTO student VALUES(NULL,"沙和尚",64.5,'2010-1-1',2);
INSERT INTO student VALUES(NULL,"玉兔",74.5,'2011-1-1',2);
INSERT INTO student VALUES(NULL,"如来",84.5,'2012-1-1',1);
~~~

## 2 创建项目  并分包 导入jar

![image-20210324093352325](https://i.loli.net/2021/03/24/zsKxlAJIev8fW1G.png)

## 3 创建工具类

### 3.1 连接数据库的工具类：jdbcutil

~~~ java
private static final String driverClass,url,user,pwd;
	static {
		driverClass="com.mysql.jabc.Driver";
		url="jdbc:mysql://localhost:3306/";
		user="root";
		pwd="root";
		try {
			Class.forName(driverClass);
		} catch (ClassNotFoundException e) {
			throw new RuntimeException(e);
		}
	}
	//创建连接
	public static Connection getCon() {
		try {
			return DriverManager.getConnection(url,user,pwd);
		} catch (SQLException e) {
			throw new RuntimeException(e);
		}
	}
	//关闭连接
	public static void closeCon(ResultSet result,Statement sta,Connection con) {
		try {
			if(result!=null)
				result.close();
			if(sta!=null)
				sta.close();
			if(con!=null)
				con.close();	
		} catch (Exception e) {
			throw new RuntimeException(e);
		}
	}
~~~



### 3.2 日期与字符串转换的工具类：DateUtil

~~~ java
package com.zhiyou100.web05servlet.util;
public class DateUtil {
     private static String pattern="yyyy-MM-dd HH:mm:ss";
     private static SimpleDateFormat sdf=new SimpleDateFormat(pattern);
     public static String  date2Str(Date date) {
    	 return sdf.format(date);
     }
     public static Date str2Date(String str) {
    	 try {
			return sdf.parse(str);
		} catch (ParseException e) {
			throw new RuntimeException(e);
		}
     }
}
~~~

## 4 实体类：根据表创建实体类

## 5为每个实体类创建dao

~~~ java
package com.zhiyou100.web05servlet.dao;
public class StudentDao implements StudentDaoInter {
	@Override
	public ArrayList<Student> getAll() {
		 Connection con=JdbcUtil.getCon();
	     PreparedStatement pre=null;
	     ResultSet set=null;
	     ArrayList<Student> list=new ArrayList<>();
	     try {
			 pre=con.prepareStatement("select * from student");
			 set=pre.executeQuery();
			 while(set.next()) {
				 int sid=set.getInt("sid");
				 String sname=set.getString("sname");
				 float score=set.getFloat("score");
				 int tid=set.getInt("tid");
				 Date stime=set.getTimestamp("stime");
				 list.add(new Student(sid, sname, score, tid, stime));
			 }
		} catch (Exception e) {
			throw new RuntimeException(e);
		}finally {
			JdbcUtil.close(con, pre, set);
		}
	     return list;
	}

	@Override
	public Student getOneBySid(int sid) {
		 Connection con=JdbcUtil.getCon();
	     PreparedStatement pre=null;
	     ResultSet set=null;
	     Student s=null;
	     try {
			 pre=con.prepareStatement("select * from student where sid=?");
			 pre.setInt(1, sid);
			 set=pre.executeQuery();
			 if(set.next()) {
				 String sname=set.getString("sname");
				 float score=set.getFloat("score");
				 int tid=set.getInt("tid");
				 Date stime=set.getTimestamp("stime");
				 s=new Student(sid, sname, score, tid, stime);
			 }
		} catch (Exception e) {
			throw new RuntimeException(e);
		}finally {
			JdbcUtil.close(con, pre, set);
		}
	     return s;
	}

	@Override
	public int updateOne(Student s) {
		 Connection con=JdbcUtil.getCon();
	     PreparedStatement pre=null;
	     int hang=0;
	     try {
			 pre=con.prepareStatement("update student set sname=?,score=?,tid=?,stime=? where sid=?");
			 pre.setString(1, s.getSname());
			 pre.setFloat(2, s.getScore());
			 pre.setInt(3, s.getTid());
			 pre.setTimestamp(4, new Timestamp(s.getStime().getTime()));
			 pre.setInt(5, s.getSid());
			 hang=pre.executeUpdate();
		} catch (Exception e) {
			throw new RuntimeException(e);
		}finally {
			JdbcUtil.close(con, pre, null);
		}
	     return hang;
	}

	@Override
	public int deleteOne(int sid) {
		 Connection con=JdbcUtil.getCon();
	     PreparedStatement pre=null;
	     int hang=0;
	     try {
			 pre=con.prepareStatement("delete from student where sid=?");
			 pre.setInt(1, sid);
			 hang=pre.executeUpdate();
		} catch (Exception e) {
			throw new RuntimeException(e);
		}finally {
			JdbcUtil.close(con, pre, null);
		}
	     return hang;
	}

	@Override
	public int insertOne(Student s) {
		 Connection con=JdbcUtil.getCon();
	     PreparedStatement pre=null;
	     int hang=0;
	     try {
			 pre=con.prepareStatement("insert into student(sname,score,tid,stime) values(?,?,?,?)");
			 pre.setString(1, s.getSname());
			 pre.setFloat(2, s.getScore());
			 pre.setInt(3, s.getTid());
			 pre.setTimestamp(4, new Timestamp(s.getStime().getTime()));
			 hang=pre.executeUpdate();
		} catch (Exception e) {
			throw new RuntimeException(e);
		}finally {
			JdbcUtil.close(con, pre, null);
		}
	     return hang;
	}
}
~~~

~~~ java
package com.zhiyou100.web05servlet.dao;
public class TeacherDao  implements TeacherDaoInter {
	public Teacher getOneByTnameAndTpwd(String tname, String tpwd) {
	     Connection con=JdbcUtil.getCon();
	     PreparedStatement pre=null;
	     ResultSet set=null;
	     Teacher t=null;
	     try {
			 pre=con.prepareStatement("select * from teacher where tname=? and tpwd=?");
			 pre.setString(1, tname);
			 pre.setString(2, tpwd);
			 set=pre.executeQuery();
			 if(set.next()) {
				 t=new Teacher(set.getInt("tid"), tname, tpwd);
			 }
		} catch (Exception e) {
			throw new RuntimeException(e);
		}finally {
			JdbcUtil.close(con, pre, set);
		}
	     return t;
	}
	public Teacher getOneByTname(String tname) {
	     Connection con=JdbcUtil.getCon();
	     PreparedStatement pre=null;
	     ResultSet set=null;
	     Teacher t=null;
	     try {
			 pre=con.prepareStatement("select * from teacher where tname=?");
			 pre.setString(1, tname);
			 set=pre.executeQuery();
			 if(set.next()) {
				 t=new Teacher(set.getInt("tid"), tname, set.getString("tpwd"));
			 }
		} catch (Exception e) {
			throw new RuntimeException(e);
		}finally {
			JdbcUtil.close(con, pre, set);
		}
	     return t;
	     
	}

	@Override
	public Teacher getOneByTid(int tid) {
		 Connection con=JdbcUtil.getCon();
	     PreparedStatement pre=null;
	     ResultSet set=null;
	     Teacher t=null;
	     try {
			 pre=con.prepareStatement("select * from teacher where tid=?");
			 pre.setInt(1, tid);
			 set=pre.executeQuery();
			 if(set.next()) {
				 t=new Teacher(tid, set.getString("tname"),  set.getString("tpwd"));
			 }
		} catch (Exception e) {
			throw new RuntimeException(e);
		}finally {
			JdbcUtil.close(con, pre, set);
		}
	     return t;
	}
	public static void main(String[] args) {
		System.out.println(new TeacherDao().getOneByTid(1));
		System.out.println(new TeacherDao().getOneByTnameAndTpwd("韩梅梅", "123"));
	}
}
~~~

# 6 创建代理页面和管理页面

> /html/day05_teacher_login.html

~~~ html
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>老师登陆页面</title>
<link  type="text/css" rel="stylesheet" href="/java34_web/css/teacher_student.css"/>
</head>
<body>
    <form  method="post" action="/java34_web/teacher/login">
           <table  id="tab_login">
               <tr>
                  <th>老师名称:</th>
                  <td><input type="text" name="tname"/></td>
               </tr>
               <tr>
                  <th>老师密码:</th>
                  <td><input type="text" name="tpwd"/></td>
               </tr>
               <tr>
                  <th  colspan="2">
                  <input type="reset" value="重置"/>  &nbsp; &nbsp; &nbsp; &nbsp;
                  <input type="submit" value="登陆"/>
                  </th>
               </tr>
           </table>
    </form>
</body>
</html>
~~~

> /html/day05_student_manager.html

~~~ html
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>学生信息管理页面</title>
<link  type="text/css" rel="stylesheet" href="/java34_web/css/teacher_student.css"/>
<link  type="text/css" rel="stylesheet" href="/java34_web/css/day04.css"/>
</head>
<body>
       <h1  align="center">学生信息的管理页面</h1>
       <a  href="/java34_web/student/getAll">获取所有信息的信息</a><br/>
       <hr/>
       <form action="/java34_web/student/getOne" method="get">
             <table>
                 <tr>
                     <td><input type="text" name="sid"/></td>
                     <th><input type="submit" value="根据学号查询"/></th>
                 </tr>
             </table>
       </form>
       <hr/>
       <form action="/java34_web/student/addOne" method="get">
             <table>
                 <tr>
                     <th>学生名字:</th>
                     <td><input type="text" name="sname"/></td>
                 </tr>
                  <tr>
                     <th>学生分数:</th>
                     <td><input type="text" name="score"/></td>
                 </tr>
                  <tr>
                     <th colspan="2">
                     <input type="reset" value="重置"/>
                        &nbsp;&nbsp;&nbsp;&nbsp;
                     <input type="submit" value="添加"/>
                     </th>
                 </tr>
             </table>
       </form>
        <hr/>
       <form action="/java34_web/student/deleteOne" method="get">
             <table>
                 <tr>
                     <td><input type="text" name="sid"/></td>
                     <th><input type="submit" value="根据学号删除一个学生"/></th>
                 </tr>
             </table>
       </form>
        <hr/>
       <form action="/java34_web/student/updateOne" method="get">
             <table>
                 <tr>
                     <th>学生编号:</th>
                     <td><input type="text" name="sid"/></td>
                 </tr>
                 <tr>
                     <th>学生名字:</th>
                     <td><input type="text" name="sname"/></td>
                 </tr>
                  <tr>
                     <th>学生分数:</th>
                     <td><input type="text" name="score"/></td>
                 </tr>
                  <tr>
                     <th colspan="2">
	                     <input type="reset" value="重置"/>
	                        &nbsp;&nbsp;&nbsp;&nbsp;
	                     <input type="submit" value="修改"/>
                     </th>
                 </tr>
             </table>
       </form>
</body>
</html>
~~~

# 7 创建老师相关的servlet

> 登陆/teacher/login

~~~ java
package com.zhiyou100.web05servlet.servlet;
@WebServlet("/teacher/login")
public class TeacherLogin extends HttpServlet {
	public void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		req.setCharacterEncoding("UTF-8");
		resp.setCharacterEncoding("UTF-8");
		resp.setContentType("text/html;charset=utf-8");
		//接受请求参数 tname tpwd
		String tname=req.getParameter("tname");
		String tpwd=req.getParameter("tpwd");
		//调用dao层的方法访问数据库
		Teacher tea=new TeacherDao().getOneByTname(tname);
		if(tea!=null&&tea.getTpwd().equals(tpwd)) {
			//登陆成功:
			//把老师装入session中
			HttpSession session=req.getSession();
			session.setAttribute("teacher", tea);
			//进入学生管理页面
			resp.sendRedirect("/java34_web/html/day05_student_manager.html";		}else {
			String message=tea==null?"账号不存在！":"密码错误！";
			//登陆失败：拼凑一个页面显示错误信息 并且等待5秒钟进入登陆页面
			resp.getWriter().print("<font color='red' size='6'>"+message+"5秒后进入登陆页面！</font>");
			resp.setHeader("Refresh", "5;/java34_web/html/day05_teacher_login.html");
		}
	}
}
~~~

> 登出/teacher/logout

~~~ java
package com.zhiyou100.web05servlet.servlet;
@WebServlet("/teacher/logout")
public class TeacherLogout extends HttpServlet {

	public void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		req.setCharacterEncoding("UTF-8");
		resp.setCharacterEncoding("UTF-8");
		resp.setContentType("text/html;charset=utf-8");
		//清空session
		req.getSession().invalidate();
		//跳转到登陆页面
		resp.sendRedirect("/java34_web/html/day05_teacher_login.html");		
	}
}
~~~

> 测试登陆和登出

# 8 创建学生相关的servlet

> 获取所有学生：/student/getAll

~~~ java
package com.zhiyou100.web05servlet.servlet;
@WebServlet("/student/getAll")
public class StudentGetAll extends HttpServlet {

	public void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		req.setCharacterEncoding("UTF-8");
		StudentDao studentDao=new StudentDao();
		ArrayList<Student> list=studentDao.getAll();
		TeacherDao teacherDao=new TeacherDao();
		for (Student s : list) {
			Teacher t=teacherDao.getOneByTid(s.getTid());
			s.setT(t);
		}
		resp.setCharacterEncoding("UTF-8");
		resp.setContentType("text/html;charset=utf-8");
		//获取当前登陆者老师的名字
		String tname=((Teacher)(req.getSession().getAttribute("teacher"))).getTname();
		//拼凑页面
		 Writer out=resp.getWriter();
		  out.write("<html>");
		  out.write("<head>");
		  out.write("<title>所有学生的信息</title>");
		  out.write("<link type='text/css' rel='stylesheet' href='"+req.getContextPath()+"/css/day04.css'/>");
		  out.write("</head>");
		  out.write("<body>");
		  out.write("<h1  align='right'>当前登陆老师为："+tname+"</h1>");
         out.write("<table>");
         out.write("<tr><th>学生编号</th><th>学生名字</th><th>学生分数</th><th>更改时间</th><th>更改老师</th></tr>");
         for (Student s : list) {
	       	  out.write("<tr>");
	       	  out.write("<td>"+s.getSid()+"</td>");
	       	  out.write("<td>"+s.getSname()+"</td>");
	       	  out.write("<td>"+s.getScore()+"</td>");
	       	  out.write("<td>"+s.getStime()+"</td>");
	       	  out.write("<td>"+s.getT().getTname()+"</td>");
	       	  out.write("</tr>");
		  }
		  out.write("</table>");
		  out.write("<a  href='/java34_web/html/day05_student_manager.html'>回到学生管理页面</a><br/>");
		  out.write("<a  href='/java34_web/teacher/logout'>退出登陆</a><br/>");
		  out.write("</body>");
		  out.write("</html>");
	}
}
~~~

> 获取一个学生：/student/getOne

~~~ java
package com.zhiyou100.web05servlet.servlet;
@WebServlet("/student/getOne")
public class StudentGetOne extends HttpServlet {

	public void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		req.setCharacterEncoding("UTF-8");
		int sid=Integer.parseInt(req.getParameter("sid"));
		StudentDao studentDao=new StudentDao();
		Student stu=studentDao.getOneBySid(sid);
		if(stu!=null) {
			TeacherDao teacherDao=new TeacherDao();
			stu.setT(teacherDao.getOneByTid(stu.getTid()));
		}
		resp.setCharacterEncoding("UTF-8");
		resp.setContentType("text/html;charset=utf-8");
		//获取当前登陆者老师的名字
		String tname=((Teacher)(req.getSession().getAttribute("teacher"))).getTname();
		//拼凑页面
		Writer out=resp.getWriter();
		  out.write("<html>");
		  out.write("<head>");
		  out.write("<title>根据学号为"+sid+"获取学生的信息</title>");
		  out.write("<link type='text/css' rel='stylesheet' href='"+req.getContextPath()+"/css/day04.css'/>");
		  out.write("</head>");
		  out.write("<body>");
		  out.write("<h1  align='right'>当前登陆老师为："+tname+"</h1>");
		  if(stu!=null) {
			  out.write("<table>");
	          out.write("<tr><th>学生编号</th><th>学生名字</th><th>学生分数</th><th>更改时间</th><th>更改老师</th></tr>");
	       	  out.write("<tr>");
	       	  out.write("<td>"+stu.getSid()+"</td>");
	       	  out.write("<td>"+stu.getSname()+"</td>");
	       	  out.write("<td>"+stu.getScore()+"</td>");
	       	  out.write("<td>"+stu.getStime()+"</td>");
	       	  out.write("<td>"+stu.getT().getTname()+"</td>");
	       	  out.write("</tr>");
	          out.write("</table>");
		  }else {
			  out.write("<font  color='red' size='6'>学号为"+sid+"的学生不存在！</font><br/>");
		  }
          
		  out.write("<a  href='/java34_web/html/day05_student_manager.html'>回到学生管理页面</a><br/>");
		  out.write("<a  href='/java34_web/teacher/logout'>退出登陆</a><br/>");
		  out.write("</body>");
		  out.write("</html>");
	}
}
~~~

> 删除一个学生：/student/deleteOne

~~~ java
package com.zhiyou100.web05servlet.servlet;
@WebServlet("/student/deleteOne")
public class StudentDeleteOne extends HttpServlet {
	public void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		req.setCharacterEncoding("UTF-8");
		//获取参数
		int sid=Integer.parseInt(req.getParameter("sid"));
		//获取当前登陆的老师
		Teacher teacher=(Teacher)(req.getSession().getAttribute("teacher"));
		int hang=new StudentDao().deleteOne(sid);
		resp.setCharacterEncoding("UTF-8");
		resp.setContentType("text/html;charset=utf-8");
		//拼凑页面
		Writer out=resp.getWriter();
		  out.write("<html>");
		  out.write("<head>");
		  out.write("<title>删除学号为为"+sid+"的学生信息</title>");
		  out.write("<link type='text/css' rel='stylesheet' href='"+req.getContextPath()+"/css/day04.css'/>");
		  out.write("</head>");
		  out.write("<body>");
		  out.write("<h1  align='right'>当前登陆老师为："+teacher.getTname()+"</h1>");
		  if(hang!=0) {
			  out.write("<font  color='blue' size='6'>学号为"+sid+"的学生删除成功！</font>");
		  }else {
			  out.write("<font  color='red' size='6'>学号为"+sid+"的学生删除失败！</font>");
		  }
		  out.write("<a  href='/java34_web/html/day05_student_manager.html'>回到学生管理页面</a><br/>");
		  out.write("<a  href='/java34_web/teacher/logout'>退出登陆</a><br/>");
		  out.write("</body>");
		  out.write("</html>");
	}
}
~~~



> 添加一个学生：/student/addOne

~~~ java
package com.zhiyou100.web05servlet.servlet;
@WebServlet("/student/addOne")
public class StudentAddOne extends HttpServlet {

	public void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		req.setCharacterEncoding("UTF-8");
		//获取参数
		String sname=req.getParameter("sname");
		float score=Float.parseFloat(req.getParameter("score"));
		//获取当前登陆的老师
		Teacher teacher=(Teacher)(req.getSession().getAttribute("teacher"));
		Student stu=new Student(null, sname, score, teacher.getTid(), new Date(), teacher);
		int hang=new StudentDao().insertOne(stu);
		resp.setCharacterEncoding("UTF-8");
		resp.setContentType("text/html;charset=utf-8");
		//拼凑页面
		Writer out=resp.getWriter();
		  out.write("<html>");
		  out.write("<head>");
		  out.write("<title>添加名字为"+sname+"的学生信息</title>");
		  out.write("<link type='text/css' rel='stylesheet' href='"+req.getContextPath()+"/css/day04.css'/>");
		  out.write("</head>");
		  out.write("<body>");
		  out.write("<h1  align='right'>当前登陆老师为："+teacher.getTname()+"</h1>");
		  if(hang!=0) {
			  out.write("<font  color='blue' size='6'>名字为"+sname+"的学生添加成功！</font><br/>");
		  }else {
			  out.write("<font  color='red' size='6'>名字为"+sname+"的学生添加失败！</font><br/>");
		  }
		  out.write("<a  href='/java34_web/html/day05_student_manager.html'>回到学生管理页面</a><br/>");
		  out.write("<a  href='/java34_web/teacher/logout'>退出登陆</a><br/>");
		  out.write("</body>");
		  out.write("</html>");
	}
}
~~~



> 修改一个学生：/student/updateOne

~~~ java
package com.zhiyou100.web05servlet.servlet;
@WebServlet("/student/updateOne")
public class StudentUpdateOne extends HttpServlet {

	public void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		req.setCharacterEncoding("UTF-8");
		//获取参数
		int sid=Integer.parseInt(req.getParameter("sid"));
		String sname=req.getParameter("sname");
		float score=Float.parseFloat(req.getParameter("score"));
		//获取当前登陆的老师
		Teacher teacher=(Teacher)(req.getSession().getAttribute("teacher"));
		Student stu=new Student(sid, sname, score, teacher.getTid(), new Date(), teacher);
		int hang=new StudentDao().updateOne(stu);
		resp.setCharacterEncoding("UTF-8");
		resp.setContentType("text/html;charset=utf-8");
		//拼凑页面
		Writer out=resp.getWriter();
		  out.write("<html>");
		  out.write("<head>");
		  out.write("<title>修改学号为"+sid+"的学生信息</title>");
		  out.write("<link type='text/css' rel='stylesheet' href='"+req.getContextPath()+"/css/day04.css'/>");
		  out.write("</head>");
		  out.write("<body>");
		  out.write("<h1  align='right'>当前登陆老师为："+teacher.getTname()+"</h1>");
		  if(hang!=0) {
			  out.write("<font  color='blue' size='6'>学号为"+sid+"的学生修改成功！</font><br/>");
		  }else {
			  out.write("<font  color='red' size='6'>学号为"+sid+"的学生不存在！</font><br/>");
		  }
		  out.write("<a  href='/java34_web/html/day05_student_manager.html'>回到学生管理页面</a><br/>");
		  out.write("<a  href='/java34_web/teacher/logout'>退出登陆</a><br/>");
		  out.write("</body>");
		  out.write("</html>");
	}
}
~~~
